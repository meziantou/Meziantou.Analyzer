# MA0100 - Await task before disposing of resources
<!-- sources -->
Source: [AwaitTaskBeforeDisposingResourcesAnalyzer.cs](https://github.com/meziantou/Meziantou.Analyzer/blob/main/src/Meziantou.Analyzer/Rules/AwaitTaskBeforeDisposingResourcesAnalyzer.cs)
<!-- sources -->

The rule detects `Task`, `Task<T>`, `ValueTask`, `ValueTask<T>`, or any type that follows the awaitable pattern.

````csharp
using System;
using System.Threading.Tasks;

class TestClass
{
    Task Demo1()
    {
        using var scope = new Disposable();
        return Task.Delay(1); // MA0100, you must await the task before disposing the scope
    }

    async Task Demo2()
    {
        using var scope = new Disposable();
        return await Task.Delay(1); // ok
    }
}
````

## Exception for ExecutionContext.SuppressFlow()

The rule does not alert when the disposable resource is `System.Threading.AsyncFlowControl` (returned by `ExecutionContext.SuppressFlow()`). This is safe because the execution context is captured at the moment of task creation, so the task doesn't need to be awaited before the using block ends.

````csharp
using System;
using System.Threading;
using System.Threading.Tasks;

class TestClass
{
    Task Demo()
    {
        using (ExecutionContext.SuppressFlow())
        {
            return Task.Run(() => DoWork()); // ok, execution context is captured at task creation
        }
    }
}
````
