# MA0186 - Equals method should use \[NotNullWhen(true)\] on the parameter
<!-- sources -->
Source: [MissingNotNullWhenAttributeOnEqualsAnalyzer.cs](https://github.com/meziantou/Meziantou.Analyzer/blob/main/src/Meziantou.Analyzer/Rules/MissingNotNullWhenAttributeOnEqualsAnalyzer.cs)
<!-- sources -->

## Description

This rule reports missing nullable attributes on method parameters to improve nullable reference type analysis:

1. When implementing `Equals(object?)` or `IEquatable<T>.Equals(T?)`, the parameter should be annotated with `[NotNullWhen(true)]` to inform the compiler that when the method returns `true`, the parameter is guaranteed to be non-null.

2. When implementing `IDictionary<TKey, TValue>.TryGetValue`, the `value` parameter should be annotated with `[MaybeNullWhen(false)]` to inform the compiler that when the method returns `false`, the parameter may be null.

## Motivation

### Equals methods

Without the `[NotNullWhen(true)]` attribute, the compiler cannot track that a successful equality comparison means the parameter is non-null. This can lead to unnecessary null checks or null-forgiving operators in code that follows an equality check.

````c#
// ❌ Without the attribute
public override bool Equals(object? obj)
{
    return obj is MyType other && /* comparison */;
}

// Usage
if (myInstance.Equals(someObj))
{
    // Compiler doesn't know someObj is not null here
    someObj.ToString(); // Warning CS8602
}

// ✅ With the attribute
public override bool Equals([NotNullWhen(true)] object? obj)
{
    return obj is MyType other && /* comparison */;
}

// Usage
if (myInstance.Equals(someObj))
{
    // Compiler knows someObj is not null here
    someObj.ToString(); // No warning
}
````

### TryGetValue methods

Without the `[MaybeNullWhen(false)]` attribute, the compiler cannot track that when `TryGetValue` returns `false`, the out parameter may be null.

````c#
// ❌ Without the attribute
public bool TryGetValue(TKey key, out TValue? value)
{
    // Implementation
}

// ✅ With the attribute
public bool TryGetValue(TKey key, [MaybeNullWhen(false)] out TValue? value)
{
    // Implementation
}

// Usage
if (dictionary.TryGetValue(key, out var value))
{
    value.ToString(); // Compiler knows value is not null
}
````

## How to fix violations

### For Equals methods

Add the `[NotNullWhen(true)]` attribute to the parameter:

````c#
using System.Diagnostics.CodeAnalysis;

public class MyType : IEquatable<MyType>
{
    public override bool Equals([NotNullWhen(true)] object? obj)
    {
        return Equals(obj as MyType);
    }

    public bool Equals([NotNullWhen(true)] MyType? other)
    {
        return other is not null && /* comparison logic */;
    }
}
````

### For TryGetValue methods

Add the `[MaybeNullWhen(false)]` attribute to the value parameter:

````c#
using System.Diagnostics.CodeAnalysis;
using System.Collections.Generic;

public class MyDictionary : IDictionary<string, string?>
{
    public bool TryGetValue(string key, [MaybeNullWhen(false)] out string? value)
    {
        // Implementation
    }
}
````

## Configuration

This rule is disabled by default as it's a suggestion for improved nullable annotations. To enable it, add the following to your `.editorconfig` file:

````editorconfig
dotnet_diagnostic.MA0186.severity = suggestion
````
