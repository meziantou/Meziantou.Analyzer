# MA0186 - Equals method should use \[NotNullWhen(true)\] on the parameter
<!-- sources -->
Source: [MissingNotNullWhenAttributeOnEqualsAnalyzer.cs](https://github.com/meziantou/Meziantou.Analyzer/blob/main/src/Meziantou.Analyzer/Rules/MissingNotNullWhenAttributeOnEqualsAnalyzer.cs)
<!-- sources -->

## Description

When implementing `Equals(object?)` or `IEquatable<T>.Equals(T?)`, the parameter should be annotated with `[NotNullWhen(true)]` to inform the compiler that when the method returns `true`, the parameter is guaranteed to be non-null. This improves nullable reference type analysis.

## Motivation

Without the `[NotNullWhen(true)]` attribute, the compiler cannot track that a successful equality comparison means the parameter is non-null. This can lead to unnecessary null checks or null-forgiving operators in code that follows an equality check.

````c#
// ❌ Without the attribute
public override bool Equals(object? obj)
{
    return obj is MyType other && /* comparison */;
}

// Usage
if (myInstance.Equals(someObj))
{
    // Compiler doesn't know someObj is not null here
    someObj.ToString(); // Warning CS8602
}

// ✅ With the attribute
public override bool Equals([NotNullWhen(true)] object? obj)
{
    return obj is MyType other && /* comparison */;
}

// Usage
if (myInstance.Equals(someObj))
{
    // Compiler knows someObj is not null here
    someObj.ToString(); // No warning
}
````

## How to fix violations

Add the `[NotNullWhen(true)]` attribute to the parameter of your `Equals` method:

````c#
using System.Diagnostics.CodeAnalysis;

public class MyType : IEquatable<MyType>
{
    public override bool Equals([NotNullWhen(true)] object? obj)
    {
        return Equals(obj as MyType);
    }

    public bool Equals([NotNullWhen(true)] MyType? other)
    {
        return other is not null && /* comparison logic */;
    }
}
````

## Configuration

This rule is disabled by default as it's a suggestion for improved nullable annotations. To enable it, add the following to your `.editorconfig` file:

````editorconfig
dotnet_diagnostic.MA0186.severity = suggestion
````
